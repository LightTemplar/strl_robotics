Запуск пайплайна состоит из нескольких последовательных этапов. В результате получается система, настроенная для проведения экспериментов на 5 этаже Физтех.Цифры

##Этап 0. Подготовка

Для запуска некоторых узлов необходимо подключаться по ssh к роботу - для этого выполните команду:

<pre><code>ssh administrator@cpr-fssl01</code></pre>
После введите пароль.


Для запуска прочих узлов в ROS1 требуется доступ к ros master. Поскольку он запускается на роботе, необходимо каждому узлу дать адрес робота, а именно - адрес рос мастера:

<pre><code> export ROS_MASTER_URI=http://cpr-fssl01:11311 </code></pre>


Эту команду необходимо выполнять в каждом новом окне терминала (если требуется запустить узел на локальной машине).

В дальнейшем, если команды выполняются на роботе, будет использоваться обозначение <b>cpr-fssl01$</b>, если на локальной машине, то <b>local$</b>. Запуск на локальной машине всегда подразумевает выполнение команды выше.

##Этап 1. Запуск LOL

LOL обеспечивает практически ground-truth позицию робота относительно 5 этажа Физтех.Цифры

Для запуска сначала введите следующие команды

<pre><code>
<b>cpr-fssl01$</b> cd catkin_ws/src/lol/docker
<b>cpr-fssl01$</b> bash start.sh /home/administrator/catkin_ws/src/
<b>cpr-fssl01$</b> bash into.sh
<b>cpr-fssl01$</b> cd catkin_ws
<b>cpr-fssl01$</b> source devel/setup.bash
<b>cpr-fssl01$</b> roslaunch lol lol.launch
</code></pre>



Далее необходимо запустить rviz в новом окне

<pre><code>
<b>local$</b> export ROS_IP=192.168.131.5
<b>local$</b> rviz
</code></pre>



После запуска rviz в выпадающем меню выбрать нужны конфиг: File->Recent Configs->~/../lol.rviz

Если все сделано правильно, то отобразится множество точек этажа и предположительно положение робота на этаже. С большой долей вероятности робот будет находиться далеко от фактического положения. Необходимо с помощью зелёной стрелки (инструмент 2D Pose Estimate) в rivz указать фактическое положение робота на карте. Иногда для этого требуется несколько последовательных шагов от отображаемого положения до фактического. 

##Этап 2. Запуск RtabMap

RtabMap выполняет построение карты проходимости вокруг робота. Для запуска выполните следующие команды. 

<pre><code>
<b>cpr-fssl01$</b> cd ~/rtabmap_ws
<b>cpr-fssl01$</b> source devel_isolated/setup.bash
<b>cpr-fssl01$</b> roslaunch rtabmap_example occupancy_grid_builder.launch
</code></pre>


Если все было сделано правильно, в rviz отобразится карта проходимости


##Этап 3. Запуск раздутия препятствий

Робот на карте - это точка, связанная с его геометрическим центром. Поэтому чисто геометрически эта точка может находиться очень близко к препятствию на карте (grid-у), но в действительности у робота есть размеры, из-за которых он не может приблизиться к стене. Поэтому имеет смысл искусственно увеличить размер препятствий на карте, чтобы избежать в дальнейшем заезда на опасно близкое расстояние. Это делает узел раздутия препятствий.

<pre><code>
<b>local$</b> roslaunch obstacle_inflation obstacle_unflator.launch
</code></pre>


Если все было сделано правильно - в rviz можно вывести топик /grid_inflated, на котором отобразится карта с раздутыми препятствиями.
##Этап 4. Запуск планировщика

Для запуска планировщика выполните команды:

<pre><code>
<b>local$</b> roslaunch planner_cds planner_cds.launch
</code></pre>

Для просмотра построенной траектории выведите в rviz топик path_visualization.

##Этап 5. Запуск контроллера

Для запуска контроллера выполните:

<pre><code>
<b>local$</b> roslaunch control control.launch method:=”0”
</code></pre>

##Использование

Для задачи задания планировщику воспользуйтесь синей стрелкой (инструмент 2D Nav Goal) в rviz. Ориентация конечного положения учитывается. После построения траектории модуль control начнет движение вдоль построенной траектории. В процессе перемещения обновляется карта проходимости, положение робота на этой карте и, при необходимости (например, возникновении ранее недоступного для обзора препятствия), происходит перепланирование траектории. При достижении конечной точки робот повернется на месте до заданной пользователем ориентации. Далее перейдет в режим ожидания следующей цели.
