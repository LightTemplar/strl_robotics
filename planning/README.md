# Описание
Данный пакет выполняет задачу планирования для системы управления Husky. Планировщик встроен в фреймворк ROS и представляет собой ROS-узел. 
## Системные требования

* Linux 18 и выше
* ROS Melodic (поддержка более поздних версий не гарантируется)

## Запуск

Запуск осуществляется при помощи утилиты roslaunch командой:

* roslaunch planner_cds planner_cds.launch 

## Общий принцип работы

Планировщику на вход должны подаваться:

1) карта проходимости - сообщение типа nav_msgs/OccupancyGrid
2) цель (конечная точка на карте) - сообщение типа geometry_msgs/PoseStamped
3) локализация робота - трансформация типа geometry_msgs/TransformStamped из пакета tf2

На выходе выводится:

1) результирующая траектория - сообщение типа geometry_msgs/PoseArray
2) визуализация этой траектории - сообщение типа visualization_msgs/Marker
 
При наличие у планировщика карты и локализации робота, пакет будет ждать поступления 
целевой точки. В случае поступления целевой точки при отсутствия карты или локализации 
будет выведена ошибка. В случае, если цель пришла после карты и локализации начнется 
процесс планирования. 

Планирования выполняется на гриде, т.е. клеточной карте. Целевая точка и локализация 
робота на входе могут быть в произвольных системах координат - планировщик атоматически 
переводит их в систему координат occupancy grid. 

На выходе получается траектория типа ломанной линии в виде точек-вершин этой линии. 
Траектория выводится в виде сообщения типа geometry_msgs/PoseArray. Также выводится 
визуализация данной траектории в rviz при помощи сообщения типа visualization_msgs/Marker.

## Конфигурация

Настройка пакета осуществляется при помощи конфигурационного файла config.yaml в 
директории src/planner_cds/Config. Доступны следующие параметры:

 * task_topic - топик, в который должна публиковаться целевая точка
 * grid_topic - топик, в который должна публиковаться карта проходимости 
 * path_topic - топик, в который должен публиковаться результирующий путь 
 * path_topic_vis - топик, в который должна публиковаться взуализация результирующего пути 
 * search_type - тип используемого планировщика, список доступных планировщиков дан в комментариях в конфиг-файле
 * global_frame - навзвание глобальной системы координат в tf
 * base_frame - название системы координат робота (локализации) в tf
 
Все параметры имет тип string.

## Визуализация и лог

В консоль при каждом новом задании выводятся коориднаты клеток старта и финиша на карте 
проходимости. Также выводится результирующее время планировния.

Для визуализации построенного пути в rviz выведите топик, указанный в конфигурационном 
файле под параметром path_topic_viz. Стандартное имя топика - path_visualization.


## Особенности

В данной версии реализовано несколько планировщиков: BFS, Dijkstra, A*, Theta* и 
JumpPoint. Выбор того или иного планировщика осуществляется с помощью парамера в 
конфигурационном файле. 

Процесс перепланирования осуществляется при поступлении новой карты проходимости. 
Он состоит из двух этапов. На первом этапе проверяется исполнимость текущего пути, 
т.е. не появилось ли на новой карте препятствия, которое старые путь будет пересекать.
 Если путь исполнимый - на этом процесс завершается и ничего не происходит. Если же 
 старый путь оказался неисполнимым, то запускается процесс планирования со старой 
 целевой точкой и новыми картой и локализацией робота. В случае успеха результирующий 
 путь публикуется в топик, в противном случае публикуется пустой путь.

В связи с особенностями работы контроллера, в публикуемой траектории исключена самая 
первая точка, связанная с локаллизацией робота. Однако в визуализации траектории эта 
точка оставлена как есть, поэтому в rviz путь отображается целиком.